<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<title>delta - アプリケーション設計実践 Tips - ホストに合わせた設定ファイルを読み込む</title>
<link href="../assets/css/base.css" rel="stylesheet" type="text/css" media="all" />
</head>
<body>
<header>
  <div class="row">
    <div class="half"> <a href="../index.html"><img src="../assets/images/logo.png" alt="delta" /></a> </div>
    <div class="half"> 
      <!--#include virtual="/global_assets/content/navi.php" --> 
    </div>
  </div>
  <h1 id="top">アプリケーション設計実践 Tips - ホストに合わせた設定ファイルを読み込む</h1>
</header>
<div id="contents">
  <article>
  <p class="right"><a href="../index.html">戻る</a><br />
    最終更新日: 2010 年 10 月 7 日</p>
  <h2>環境依存の設定 </h2>
  <p>アプリケーションファイル (application.yml) には接続先のデータベースやメールサーバの情報を定義することがありますが、実開発においてはステージング環境とプロダクション環境で接続先のサーバが異なることがあります。このような場合、対象となるサーバ上で設定ファイルの内容を書き換えることがありますが、ソースの管理にバージョン管理システムを導入していると少し厄介なことになります。</p>
  <p>この問題に対応するために、delta には環境依存の設定を拡張ファイルに定義する方法が用意されています。拡張ファイルは設定ファイル名の後にホスト名を付加した形式になります。例えばホスト名が &quot;foo&quot; であれば、拡張ファイルの名前は &quot;application_foo.yml&quot; となります。拡張ファイルはオリジナルファイルの内容を元に値をオーバーライドすることができます。</p>
  <div class="note_container note_hint">
    <div class="note_bar"><img src="../assets/images/icons/hint.png" width="32" height="32" alt="ヒント" /></div>
    <div class="note_contents">
      <p>ホスト名は Linux の場合、hostname コマンドで確認することができます。 </p>
    </div>
  </div>
  <p>それでは設定ファイルのオーバーライドを試してみましょう。</p>
  <dl>
    <dt>YAML Code: config/application.yml</dt>
    <dd class="lang_yaml"><code>database:<br />
      &nbsp;&nbsp;default:<br />
      &nbsp;&nbsp;&nbsp;&nbsp;dsn: 'mysql:host=localhost; dbname=staging'<br />
      &nbsp;&nbsp;&nbsp;&nbsp;user: testuser <br />
      &nbsp;&nbsp;&nbsp;&nbsp;password: testpassword</code></dd>
    <dt>YAML Code: config/application_foo.yml (拡張設定ファイル)</dt>
    <dd class="lang_yaml"><code># 属性のオーバーライド<br />
      database:<br />
      &nbsp;&nbsp;default:<br />
      &nbsp;&nbsp;&nbsp;&nbsp;dsn: 'mysql:host=192.168.0.100; dbname=production'<br />
      <br />
      # 拡張属性 <br />
      extend: TRUE</code></dd>
  </dl>
  <p>デフォルトの接続先データベースは localhost ですが、ホスト foo からプロパティファイルを参照すると接続先は 192.168.0.100 になります。</p>
  <p>実際に設定ファイルの内容がどうなっているか確認してみましょう。 </p>
  <dl>
    <dt>PHP Code:</dt>
    <dd class="lang_php"><code>print_r(Delta_Config::getApplication();<br />
      <br />
      // 
      array('database' =&gt; <br />
      // 
      &nbsp;&nbsp;array('default' =&gt;<br />
      //&nbsp;&nbsp;&nbsp;&nbsp;    array('dsn' =&gt; <br />
      //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    array('mysql:host=192.168.0.100; dbname=production'),<br />
      //    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array('user' =&gt; 'testuser'),<br />
      //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; array('password' =&gt; 'testuser')<br />
      // &nbsp;&nbsp;&nbsp;&nbsp;}, <br />
      //
      &nbsp;&nbsp;),<br />
      //
      
      &nbsp;
      array('extend' =&gt; TRUE)<br />
      //&nbsp;}<br />
      // </code></dd>
  </dl>
  <p>データベースの接続先がオーバーライドされ、拡張属性 (extend) が追加されていることが分かります。</p>
  <h2>拡張設定が有効なファイル</h2>
  <p>ホスト名による設定の拡張は次のファイルで有効です。</p>
  <dl>
    <table>
      <colgroup>
      <col width="30%" />
      <col width="30%" />
      <col width="40%" />
      </colgroup>
      <tr>
        <th scope="col">設定ファイル</th>
        <th scope="col">拡張ファイル名</th>
        <th scope="col">設定値を参照するメソッド</th>
      </tr>
      <tr>
        <td>config/application.yml</td>
        <td>config/application_{hostname}.yml</td>
        <td>Delta_Config::getApplication()</td>
      </tr>
      <tr>
        <td>config/site.yml</td>
        <td>config/site_{hostname}.yml</td>
        <td>Delta_Config::getSite()</td>
      </tr>
    </table>
  </dl>
  <p class="right"><a href="#top">上へ</a></p>
</div>
</div>
<footer>
  <p>Copyright &copy; delta framework project.</p>
</footer>
</body>
</html>
